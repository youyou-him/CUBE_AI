<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Î¶¨Î∑∞ Í∞êÏÑ± Î∂ÑÏÑù</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F7F8FC; }
        .sidebar-active {
            color: #2563EB;
            background-color: #EFF6FF;
            border-left: 3px solid #2563EB;
            font-weight: 600;
        }
    </style>
</head>
<body class="text-gray-800">
<div class="flex h-screen bg-[#F7F8FC]">
    <!-- Sidebar -->
    <aside class="w-64 bg-white flex flex-col p-4 border-r">
        <div class="flex items-center space-x-3 px-2 py-4">
            <div class="p-2 bg-blue-600 rounded-lg">
                <i data-lucide="bar-chart-3" class="text-white w-6 h-6"></i>
            </div>
            <h1 class="text-xl font-bold text-gray-800">CRM Cube</h1>
        </div>
        <nav class="flex-1 mt-8 space-y-2">
            <p class="px-4 text-sm font-semibold text-gray-400 uppercase">Managements</p>
            <a th:href="@{/}" class="flex items-center px-4 py-2.5 text-gray-500 hover:bg-gray-100 rounded-lg">
                <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                Overview
            </a>
            <a th:href="@{/reviews}" class="flex items-center px-4 py-2.5 text-gray-600 sidebar-active">
                <i data-lucide="message-circle" class="w-5 h-5 mr-3"></i>
                Review Analysis
            </a>
            <a th:href="@{/recommendations(customerId='00012a2ce6f8dcda20d059ce98491703')}" class="flex items-center px-4 py-2.5 text-gray-500 hover:bg-gray-100 rounded-lg">
                <i data-lucide="star" class="w-5 h-5 mr-3"></i>
                Recommendations
            </a>
            <a th:href="@{/clv-analysis}" class="flex items-center px-4 py-2.5 text-gray-500 hover:bg-gray-100 rounded-lg">
                <i data-lucide="gem" class="w-5 h-5 mr-3"></i>
                CLV Analysis
            </a>
        </nav>
        <div class="pb-4">
            <div class="bg-blue-50 p-4 rounded-lg text-sm text-center">
                <p class="font-bold text-blue-800">High-Risk Customers</p>
                <p class="text-blue-600 my-1">There are <span class="font-bold">892</span> customers at risk of churn.</p>
                <button class="mt-2 w-full py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-xs">Check Now</button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white px-8 py-4 flex justify-between items-center border-b">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">Review Sentiment Analysis</h2>
                <p class="text-sm text-gray-500">Analyze customer feedback with translation and keyword analysis.</p>
            </div>
            <!-- üö®üö®üö® ÌïµÏã¨ ÏàòÏ†ï: Î≤ÑÌäº Ï∂îÍ∞Ä üö®üö®üö® -->
            <a th:href="@{/rev}"
               class="px-4 py-2 bg-blue-100 text-blue-700 text-sm font-semibold rounded-lg hover:bg-blue-200">
                Ï†ÑÏ≤¥ Î∂ÄÏ†ï ÌÇ§ÏõåÎìú ÏãúÍ∞ÅÌôî Î≥¥Í∏∞
            </a>
        </header>

        <div class="flex-1 p-8 overflow-y-auto">
            <!-- WordCloud Î∞è ÏÉÅÏúÑ ÌÇ§ÏõåÎìú ÏãúÍ∞ÅÌôî ÏÑπÏÖò -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8" th:if="${wordCloudData != null}">
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Negative Keywords Word Cloud</h3>
                    <div class="flex justify-center items-center h-full">
                        <img th:src="${wordCloudData.wordcloudImageSrc}" alt="Word Cloud of negative reviews" class="max-w-full h-auto">
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Top 20 Negative Keywords</h3>
                    <div class="space-y-2" th:if="${wordCloudData.topKeywords != null and !wordCloudData.topKeywords.isEmpty()}">
                        <div th:each="keyword : ${wordCloudData.topKeywords}" class="flex items-center">
                            <span class="w-32 text-sm font-semibold text-gray-600 truncate" th:text="${keyword.word}"></span>
                            <div class="flex-1 bg-gray-200 rounded-full h-4">
                                <div class="bg-red-400 h-4 rounded-full text-right pr-2 text-white text-xs leading-4"
                                     th:style="'width: ' + (${keyword.count} / ${wordCloudData.topKeywords[0].count} * 100) + '%; min-width: 25px;'"
                                     th:text="${keyword.count}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÏµúÍ∑º Î¶¨Î∑∞ Í∞úÎ≥Ñ Î∂ÑÏÑù Î™©Î°ù -->
            <div class="bg-white p-6 rounded-xl shadow-sm">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Recent Reviews Analysis</h3>
                <div class="divide-y divide-gray-200">
                    <div th:each="result : ${analysisResults}" class="py-4">
                        <!-- ÏõêÎ≥∏ Î¶¨Î∑∞ (Ìè¨Î•¥Ìà¨Í∞àÏñ¥) -->
                        <p class="text-sm text-gray-700 italic" th:text="${result.review.reviewCommentMessage}"></p>

                        <!-- (‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ Î≤àÏó≠Îêú Î¶¨Î∑∞ ÌÖçÏä§Ìä∏ ÌëúÏãú ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ) -->
                        <div th:if="${result.sentiment != null and result.sentiment.translatedText != null}"
                             class="mt-2 p-3 bg-gray-50 border-l-4 border-gray-300 rounded-r-lg">
                            <p class="text-sm text-gray-600" th:text="${result.sentiment.translatedText}"></p>
                        </div>

                        <div class="flex items-center justify-between mt-3">
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span>Original Score: <strong th:text="${result.review.reviewScore}"></strong></span>
                                <span th:if="${result.review.reviewCreationDate != null}" th:text="${#temporals.format(result.review.reviewCreationDate, 'yyyy-MM-dd')}"></span>
                            </div>
                            <div th:if="${result.sentiment != null}" class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full"
                                      th:text="${result.sentiment.sentimentLabel}"
                                      th:classappend="${result.sentiment.sentiment == 1} ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                </span>
                                <span class="text-sm font-bold" th:text="${#numbers.formatDecimal(result.sentiment.score * 100, 1, 1)} + '%'"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<script>
    lucide.createIcons();
</script>
</body>
</html>

