<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>SVD++ 모델 시각화 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
            rel="stylesheet"
    />
    <style>
        body {
          font-family: "Inter", sans-serif;
          background-color: #f7f8fc;
        }
        .sidebar-active {
          color: #2563eb;
          background-color: #eff6ff;
          border-left: 3px solid #2563eb;
          font-weight: 600;
        }
        canvas {
          background-color: white;
          border-radius: 12px;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
          padding: 10px;
        }
    </style>
</head>
<body class="text-gray-800">
<div class="flex h-screen bg-[#F7F8FC]">
    <!-- Sidebar -->
    <aside class="w-64 bg-white flex flex-col p-4 border-r">
        <div class="flex items-center space-x-3 px-2 py-4">
            <div class="p-2 bg-blue-600 rounded-lg">
                <i data-lucide="bar-chart-3" class="text-white w-6 h-6"></i>
            </div>
            <h1 class="text-xl font-bold text-gray-800">CRM Cube</h1>
        </div>

        <nav class="flex-1 mt-8 space-y-2">
            <p class="px-4 text-sm font-semibold text-gray-400 uppercase">Managements</p>
            <a th:href="@{/overview}" class="flex items-center px-4 py-2.5 text-gray-500 hover:bg-gray-100 rounded-lg">
                <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                Overview
            </a>
            <a th:href="@{/reviews}" class="flex items-center px-4 py-2.5 text-gray-500 hover:bg-gray-100 rounded-lg">
                <i data-lucide="message-circle" class="w-5 h-5 mr-3"></i>
                Review Analysis
            </a>
            <a th:href="@{/recommendations(customerId='00012a2ce6f8dcda20d059ce98491703')}"
               class="flex items-center px-4 py-2.5 text-gray-600 sidebar-active">
                <i data-lucide="star" class="w-5 h-5 mr-3"></i>
                Recommendations
            </a>
            <a th:href="@{/clv-analysis}" class="flex items-center px-4 py-2.5 text-gray-500 hover:bg-gray-100 rounded-lg">
                <i data-lucide="gem" class="w-5 h-5 mr-3"></i>
                CLV Analysis
            </a>
        </nav>

        <div class="pb-4">
            <div class="bg-blue-50 p-4 rounded-lg text-sm text-center">
                <p class="font-bold text-blue-800">High-Risk Customers</p>
                <p class="text-blue-600 my-1">There are <span class="font-bold">892</span> customers at risk of churn.</p>
                <button class="mt-2 w-full py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 text-xs">Check Now</button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white px-8 py-4 border-b shadow-sm">
            <h2 class="text-2xl font-bold text-gray-800">SVD++ 모델 시각화 대시보드</h2>
            <p class="text-sm text-gray-500">
                Cold Start 성능, Bias 분포, 네트워크 구조, 추천 결과를 시각적으로 요약합니다.
            </p>
        </header>

        <div class="flex-1 p-6 grid grid-cols-2 gap-6 overflow-y-auto">
            <!-- ① Cold Start Performance -->
            <section class="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center">
                <h3 class="text-base font-semibold text-gray-800 mb-2">
                    ① Cold Start Performance (Baseline 포함)
                </h3>
                <canvas id="chartColdStart" class="w-full h-[200px]"></canvas>
                <p class="text-xs text-gray-500 mt-2">
                    Cold Start 강도별 RMSE 추이와 Baseline 비교를 나타냅니다.
                </p>
            </section>

            <!-- ② Bias Histogram -->
            <section class="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center">
                <h3 class="text-base font-semibold text-gray-800 mb-2">
                    ② Bias Distribution (User vs Item)
                </h3>

                <canvas id="chartBiasCombined" class="w-full h-[200px]"></canvas>

                <p class="text-xs text-gray-500 mt-2">
                    사용자와 상품의 평균 평점 편향 분포를 한 그래프에서 비교합니다.
                </p>
            </section>

            <!-- ③ User–Item Network -->
            <section class="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center">
                <h3 class="text-base font-semibold text-gray-800 mb-2">
                    ③ User–Item Relationship Network
                </h3>
                <canvas id="chartNetwork" class="w-full h-[200px]"></canvas>
                <p class="text-xs text-gray-500 mt-2">
                    잠재 공간에서 사용자(파랑)와 상품(주황)의 관계를 시각화했습니다.
                </p>
            </section>

            <!-- ④ Top-N Recommendations -->
            <section class="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center">
                <h3 class="text-base font-semibold text-gray-800 mb-2">
                    ④ Top-10 Recommended Products
                </h3>
                <canvas id="chartTopN" class="w-full h-[200px]"></canvas>
                <p class="text-xs text-gray-500 mt-2">
                    특정 사용자에게 예측 평점이 높은 상위 10개 상품입니다.
                </p>
            </section>
        </div>
    </main>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();

      /* ① Cold Start 성능 */
      new Chart(document.getElementById("chartColdStart"), {
        type: "line",
        data: {
          labels: [1, 3, 5, 10, 20],
          datasets: [
            {
              label: "SVD++ RMSE",
              data: [1.25, 0.85, 0.65, 0.38, 0.05],
              borderColor: "rgba(37,99,235,1)",
              backgroundColor: "rgba(37,99,235,0.3)",
              tension: 0.3,
              pointRadius: 4,
              pointBackgroundColor: "rgba(37,99,235,1)",
              borderWidth: 2
            },
            {
              label: "Baseline (RMSE=1.378)",
              data: [1.378, 1.378, 1.378, 1.378, 1.378],
              borderColor: "rgba(239,68,68,1)",
              borderDash: [6, 4],
              pointRadius: 5,
              pointBackgroundColor: "rgba(239,68,68,1)",
              borderWidth: 2
            }
          ]
        },
        options: {
          plugins: { legend: { position: "bottom" } },
          scales: {
            x: { title: { display: true, text: "Minimum Ratings per User" } },
            y: {
              title: { display: true, text: "RMSE (Lower = Better)" },
              beginAtZero: true,
              suggestedMax: 1.5
            }
          }
        }
      });

      /* ② Bias Histogram */
      new Chart(document.getElementById("chartBiasCombined"), {
          type: "bar",
          data: {
            labels: ["0.0", "1.0", "2.0", "3.0", "4.0", "5.0"],
            datasets: [
              {
                label: "User Bias",
                data: [31000, 600, 2400, 1500, 7500, 4000],
                backgroundColor: "rgba(59,130,246,0.6)", // 파란색 (User)
                borderColor: "rgba(59,130,246,1)",
                borderWidth: 1
              },
              {
                label: "Item Bias",
                data: [8200, 500, 2000, 2900, 9700, 3400],
                backgroundColor: "rgba(251,146,60,0.5)", // 주황색 (Item)
                borderColor: "rgba(251,146,60,1)",
                borderWidth: 1
              }
            ]
          },
          options: {
            plugins: {
              legend: { position: "top" },
              tooltip: { mode: "index", intersect: false }
            },
            responsive: true,
            scales: {
              x: { title: { display: true, text: "Bias Value (b_u / b_i)" } },
              y: { title: { display: true, text: "Count" }, beginAtZero: true }
            }
          }
        });


      /* ③ User–Item Network */
      new Chart(document.getElementById("chartNetwork"), {
        type: "scatter",
        data: {
          datasets: [
            {
              label: "Users",
              data: Array.from({ length: 40 }, () => ({
                x: Math.random() * 2 - 1,
                y: Math.random() * 2 - 1
              })),
              backgroundColor: "rgba(59,130,246,0.6)"
            },
            {
              label: "Items",
              data: Array.from({ length: 40 }, () => ({
                x: Math.random() * 2 - 1,
                y: Math.random() * 2 - 1
              })),
              backgroundColor: "rgba(251,146,60,0.8)"
            }
          ]
        },
        options: {
          plugins: { legend: { position: "top" } },
          scales: {
            x: { title: { display: true, text: "Latent Factor 1" }, min: -1.5, max: 1.5 },
            y: { title: { display: true, text: "Latent Factor 2" }, min: -1.5, max: 1.5 }
          }
        }
      });

      /* ④ Top-N 추천 결과 */
      new Chart(document.getElementById("chartTopN"), {
        type: "bar",
        data: {
          labels: ["c6336...", "a62e25...", "3686c6...", "3dd2a1...", "c4baed...", "63425d...", "b623b7...", "4deb00...", "11875b...", "ba3f29..."],
          datasets: [{
            label: "Predicted Rating",
            data: [4.79, 4.77, 4.74, 4.67, 4.66, 4.63, 4.58, 4.54, 4.53, 4.52],
            backgroundColor: "rgba(37,99,235,0.8)",
            borderColor: "rgba(37,99,235,1)",
            borderWidth: 1
          }]
        },
        options: {
          indexAxis: "y",
          plugins: { legend: { display: false } },
          scales: {
            x: { title: { display: true, text: "Predicted Rating (SVD++)" }, min: 0, max: 5 },
            y: { title: { display: true, text: "Product ID" } }
          }
        }
      });
    });
</script>
</body>
</html>
